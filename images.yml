---
base_url: 'https://gitlab.com/coq-community/docker-base'
active: true
docker_repo: 'coqorg/base'
args:
  OPAM_VERSION: '2.0.7'
  # pass these args albeit they are not used by all Dockerfiles:
  OCAMLFIND_VERSION: '1.8.1'
  DUNE_VERSION: '2.5.1'
images:
  - matrix:
      # TODO: remove 4.09.0-flambda later on
      tag: ['4.09.0-flambda']
    build:
      context: './base'
      dockerfile: './single/Dockerfile'
      args:
        COMPILER: '{matrix[tag][//-/+]}'
        NUM_VERSION: '1.3'
      tags:
        - tag: '{matrix[tag]}'
  - matrix:
      # TODO: replace latest with two single switches
      tag: ['latest']
    build:
      context: './base'
      dockerfile: './dual/Dockerfile'
      args:
        COMPILER: '4.05.0'
        COMPILER_EDGE: '4.07.1+flambda'
        # TODO: then specify NUM_VERSION
      tags:
        - tag: '{matrix[tag]}'
  - matrix:
      tag: ['4.02.3']
    build:
      context: './base'
      dockerfile: './single/Dockerfile'
      args:
        COMPILER: '{matrix[tag]}'
        NUM_VERSION: '0'
      tags:
        - tag: '{matrix[tag]}'
  - matrix:
      tag: ['bare']
    build:
      context: './base'
      dockerfile: './bare/Dockerfile'
      args:
        # TODO: refactor later on
        COMPILER: '4.05.0'
        COMPILER_EDGE: '4.07.1+flambda'
      tags:
        - tag: '{matrix[tag]}'
